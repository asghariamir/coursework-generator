<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Coursework LaTeX Generator</title>
<style>
:root{--ink:#111827;--muted:#6b7280;--primary:#2563eb;--bg:#f9fafb;--card:#fff;--border:#e5e7eb}
*{box-sizing:border-box}
html,body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
.container{max-width:1200px;margin:0 auto;padding:20px}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:40px 20px;text-align:center;border-radius:12px;margin-bottom:30px;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
.header h1{margin:0 0 10px;font-size:36px;font-weight:700}
.header p{margin:0;opacity:0.95;font-size:18px}
.card{background:var(--card);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 4px 6px rgba(0,0,0,0.07)}
.card h2{color:var(--primary);margin:0 0 20px;font-size:24px;display:flex;align-items:center;gap:10px}
.btn-group{display:flex;gap:12px;flex-wrap:wrap;margin:20px 0}
button{padding:12px 24px;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.2s}
.btn-primary{background:var(--primary);color:white}
.btn-primary:hover{background:#1d4ed8;transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,99,235,0.2)}
.btn-danger{background:#dc2626;color:white}
.btn-danger:hover{background:#b91c1c}
.btn-success{background:#10b981;color:white}
.btn-success:hover{background:#059669}
.btn-secondary{background:#6b7280;color:white}
.btn-secondary:hover{background:#4b5563}
.course-selector{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0}
.course-btn{padding:16px;border:2px solid var(--border);border-radius:8px;background:white;cursor:pointer;transition:all 0.2s;text-align:left}
.course-btn:hover{border-color:var(--primary);background:#f0f4ff}
.course-btn.active{border-color:var(--primary);background:linear-gradient(to right,#f0f4ff,#e6efff);box-shadow:0 2px 8px rgba(37,99,235,0.1)}
.course-btn h3{margin:0 0 4px;color:var(--primary);font-size:16px}
.course-btn p{margin:0;font-size:13px;color:var(--muted)}
.preview-box{background:#1e1e1e;color:#d4d4d4;border-radius:8px;padding:20px;min-height:300px;max-height:500px;overflow-y:auto;font-family:'Courier New',monospace;font-size:12px;line-height:1.5;white-space:pre-wrap;width:100%}
.student-list{background:#f3f4f6;padding:15px;border-radius:8px;max-height:400px;overflow-y:auto}
.student-item{display:flex;justify-content:space-between;padding:8px;margin:4px 0;background:white;border-radius:4px;font-size:14px}
.student-name{font-weight:600;color:var(--ink)}
.student-id{color:var(--muted);font-family:monospace}
.student-variant{background:var(--primary);color:white;padding:2px 8px;border-radius:4px;font-size:12px;font-weight:600}
.info-box{background:#e0f2fe;color:#0c4a6e;padding:16px;border-radius:8px;margin:20px 0;border-left:4px solid #0284c7}
.success-box{background:#d1fae5;border:1px solid #6ee7b7;color:#065f46;padding:16px;border-radius:8px;margin:20px 0}
.warning-box{background:#fef3c7;border:1px solid #fbbf24;color:#92400e;padding:16px;border-radius:8px;margin:20px 0}
.footer{text-align:center;padding:40px 20px;color:var(--muted);font-size:14px}
.progress{margin:20px 0;padding:10px;background:#f9f9f9;border-radius:8px;font-family:monospace;font-size:12px;max-height:200px;overflow-y:auto}
.form-group{margin:15px 0}
.form-group label{display:block;margin-bottom:5px;font-weight:600;color:var(--ink);font-size:14px}
.form-control{width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:14px}
.form-control:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
select.form-control{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px}
.divider{border-top:2px solid var(--border);margin:30px 0}
.tabs{display:flex;gap:4px;margin-bottom:20px;background:#f3f4f6;padding:4px;border-radius:8px}
.tab{padding:10px 20px;border:none;background:transparent;color:var(--muted);font-weight:600;cursor:pointer;border-radius:6px;transition:all 0.2s}
.tab.active{background:white;color:var(--primary);box-shadow:0 2px 4px rgba(0,0,0,0.05)}
.tab-content{display:none}
.tab-content.active{display:block}
@media(max-width:600px){
  .course-selector{grid-template-columns:1fr}
  .tabs{flex-direction:column}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìù Coursework LaTeX Generator</h1>
    <p>Generate Individual or Batch Assignments</p>
  </div>

  <div class="card">
    <h2>üéØ Generation Mode</h2>
    <div class="tabs">
      <button class="tab active" onclick="switchTab('individual', this)">Individual Generation</button>
      <button class="tab" onclick="switchTab('batch', this)">Batch Generation (All 19)</button>
    </div>

    <!-- Individual Generation Tab -->
    <div id="individual-tab" class="tab-content active">
      <div class="course-selector">
        <div class="course-btn active" data-course="cf" onclick="selectCourse('cf',this)">
          <h3>üìà Dynamical Systems</h3>
          <p>Chaos & Fractals</p>
        </div>
        <div class="course-btn" data-course="nm" onclick="selectCourse('nm',this)">
          <h3>üî¢ Numerical Methods</h3>
          <p>Algorithms & Analysis</p>
        </div>
      </div>

      <div class="form-group">
        <label for="studentSelect">Select Student from Class List:</label>
        <select id="studentSelect" class="form-control" onchange="updateSelectedStudent()">
          <option value="">-- Choose a student --</option>
        </select>
      </div>

      <div class="divider"></div>

      <div class="warning-box">
        <strong>OR</strong> enter custom student details below:
      </div>

      <div class="form-group">
        <label for="customName">Custom Student Name:</label>
        <input type="text" id="customName" class="form-control" placeholder="e.g., John Smith">
      </div>

      <div class="form-group">
        <label for="customID">Custom Student ID:</label>
        <input type="text" id="customID" class="form-control" placeholder="e.g., 21111234567" maxlength="11">
      </div>

      <div class="form-group">
        <label for="variantSelect">Variant Number (1‚Äì30):</label>
        <input type="number" id="variantSelect" class="form-control" min="1" max="30" value="1">
      </div>

      <div class="info-box">
        <strong>Auto-Variant Calculation:</strong> When using class list, variant is calculated as: 1 + (last 6 digits of ID) mod 30<br>
        <strong>Custom Override:</strong> You can manually set any variant 1‚Äì30
      </div>

      <div class="btn-group">
        <button class="btn-primary" onclick="generateIndividual()">üìÑ Generate Individual LaTeX</button>
        <button class="btn-success" onclick="downloadIndividual()">üíæ Download LaTeX File</button>
        <button class="btn-secondary" onclick="clearIndividualForm()">üîÑ Clear Form</button>
      </div>
    </div>

    <!-- Batch Generation Tab -->
    <div id="batch-tab" class="tab-content">
      <div class="course-selector">
        <div class="course-btn active" data-course="cf" onclick="selectCourse('cf',this)">
          <h3>üìà Dynamical Systems</h3>
          <p>Chaos & Fractals</p>
        </div>
        <div class="course-btn" data-course="nm" onclick="selectCourse('nm',this)">
          <h3>üî¢ Numerical Methods</h3>
          <p>Algorithms & Analysis</p>
        </div>
      </div>

      <div class="student-list" id="studentList"></div>

      <div class="info-box">
        <strong>Total Students:</strong> 19<br>
        <strong>Variants:</strong> Auto-calculated from Student IDs<br>
        <strong>Output:</strong> 19 LaTeX files ready for compilation
      </div>

      <div class="btn-group">
        <button class="btn-danger" onclick="generateAllStudents()">üöÄ Generate All 19 LaTeX Files</button>
        <button class="btn-success" onclick="downloadAllAsZip()">üì¶ Download All (as individual files)</button>
      </div>

      <div id="progress" class="progress" style="display:none"></div>
    </div>
  </div>

  <div class="card">
    <h2>üìù LaTeX Output Preview</h2>
    <div class="success-box" style="display:none" id="compile-instructions">
      <strong>‚úÖ Files Generated!</strong>
      <ol style="margin:10px 0 0 20px">
        <li>Download the LaTeX file(s)</li>
        <li>Upload to Overleaf or compile with <code>pdflatex</code></li>
        <li>Each student has their personalized assignment</li>
      </ol>
    </div>
    <textarea id="latexOutput" class="preview-box" readonly>% LaTeX output will appear here
% Use Individual or Batch generation to create files</textarea>
  </div>

  <div class="footer">
    <p>¬© 2025 Coursework Generator ‚Ä¢ Professional LaTeX Output</p>
  </div>
</div>

<script>
// ===== Student data =====
const students = [
  {name: "Oli Bailey", id: "21111388943"},
  {name: "Tian Dawson-Shenton", id: "21111383107"},
  {name: "Billie Dawson", id: "21111373089"},
  {name: "Mia Greenhalgh", id: "21111387863"},
  {name: "Josh Hainsworth", id: "21111389833"},
  {name: "Alice Hughes", id: "21111388110"},
  {name: "Josh Hughes", id: "21111385475"},
  {name: "Holly Jones", id: "21111389807"},
  {name: "Jorge Lattimore", id: "21111388950"},
  {name: "Emily Morris", id: "21111382584"},
  {name: "James Oconnor", id: "21111389808"},
  {name: "Max Parrott", id: "21111388188"},
  {name: "Alfie Robinson", id: "21111385759"},
  {name: "Evie Schofield", id: "21111388083"},
  {name: "Harriet Shadbolt", id: "21111382216"},
  {name: "Kacper Swiatlowski", id: "21111388302"},
  {name: "Charlotte Tasker", id: "21111385728"},
  {name: "Louis Tornerup", id: "21111365511"},
  {name: "Amy Williams", id: "21111389832"}
];

// Precompute variants
students.forEach(s => {
  const last6 = parseInt(s.id.slice(-6), 10);
  s.variant = 1 + (last6 % 30);
});

// ===== State =====
let currentCourse = 'cf'; // default to Dynamical Systems
let generatedFiles = [];
let currentIndividualFile = null;

// ===== Tabs =====
function switchTab(tab, el){
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(`${tab}-tab`).classList.add('active');
}

// ===== Populate UI =====
function populateStudentDropdown(){
  const sel = document.getElementById('studentSelect');
  sel.innerHTML = '<option value="">-- Choose a student --</option>';
  students.forEach((s,i)=>{
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = `${s.name} (${s.id}) ‚Äî Variant ${s.variant}`;
    sel.appendChild(opt);
  });
}
function displayStudents(){
  const list = document.getElementById('studentList');
  list.innerHTML = students.map(s => `
    <div class="student-item">
      <span class="student-name">${s.name}</span>
      <span class="student-id">${s.id}</span>
      <span class="student-variant">Variant ${s.variant}</span>
    </div>
  `).join('');
}
function updateSelectedStudent(){
  const index = document.getElementById('studentSelect').value;
  if(index !== ''){
    const s = students[Number(index)];
    document.getElementById('customName').value = '';
    document.getElementById('customID').value = '';
    document.getElementById('variantSelect').value = s.variant;
  }
}
function clearIndividualForm(){
  document.getElementById('studentSelect').value = '';
  document.getElementById('customName').value = '';
  document.getElementById('customID').value = '';
  document.getElementById('variantSelect').value = '1';
  currentIndividualFile = null;
  document.getElementById('latexOutput').value = '% LaTeX output will appear here\n% Use Individual or Batch generation to create files';
  document.getElementById('compile-instructions').style.display = 'none';
}
function selectCourse(course, btn){
  currentCourse = course;
  document.querySelectorAll('.course-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll(`.course-btn[data-course="${course}"]`).forEach(b=>b.classList.add('active'));
}

// ===== RNG helpers =====
function mulberry32(a){
  return function(){
    a |= 0; a = (a + 0x6D2B79F5) | 0;
    var t = Math.imul(a ^ (a >>> 15), 1 | a);
    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function pick(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }

// ===== Parameter pools =====
const pools = {
  nm: {
    q1Families: [
      {key:'ax_minus_bexp', params:{a:[1.5,2,2.5,3,3.5], b:[1.2,1.6,2,2.4,3], k:[0.8,1,1.2,1.6,2,2.5,3]}},
      {key:'cubic', params:{alpha:[0.7,1,2,3], beta:[1,2,3]}},
      {key:'coskx_minus_x', params:{k:[1,1.2,1.5,2]}},
      {key:'exp_minus_gamma_x', params:{gamma:[1.5,2,3,4]}},
      {key:'log_shift_minus_eta', params:{delta:[0.5,1,2], eta:[0.1,0.3,0.5]}}
    ],
    q2Funcs: [
      {f:"\\cos x",A:0,B:Math.PI}, {f:"\\sin x",A:0,B:Math.PI}, {f:"e^x",A:0,B:1.2},
      {f:"e^{0.6x}",A:0,B:2.2}, {f:"\\ln(1+x)",A:0,B:0.9}, {f:"\\sqrt{1+x^2}",A:0,B:1.6},
      {f:"\\arctan x",A:0,B:1.6}, {f:"e^{x/2} \\cos x",A:0,B:1.8}, {f:"(1+x)^{1/3}",A:0,B:0.8}
    ],
    q3Families: [
      {key:'ay', params:{a:[-1.2,-1,-0.8,0.6,0.8,1]}},
      {key:'x_plus_y', params:{}},
      {key:'mxy', params:{}},
      {key:'siny_y', params:{}},
      {key:'lin_forced', params:{lambda:[0.6,0.8,1,1.2], B:[1.2,1.6,2], omega:[0.9,1,1.2]}}
    ],
    q4Params: {c:[1.5,2,2.5,3], y0:[8,10,12,14], v0:[20,25,30,35,40]}
  },
  cf: {
    // Q1 x0 used only in text; computations are up to the student
    x0Choices: [[0.1,0.3,0.9],[0.12,0.34,0.78],[0.2,0.37,0.51],[0.05,0.25,0.85]],
    abCases: [{a:1,b:1},{a:1.5,b:0.5},{a:3.25,b:1}],
    tentS:[1.6,1.7,1.8,1.9],
    juliaC:["-0.8+0.156i","-0.101+0.635i","-0.745+0.186i","-0.12-0.75i","-0.75+0.1i","-0.1+0.62i"]
  }
};

// ===== LaTeX generators =====
function generateNMLaTeX(variant, student, sid){
  const rng = mulberry32(0xA11CE ^ variant);

  // Q1 choice
  const fam1 = pick(rng, pools.nm.q1Families);
  const params1 = {};
  for(const k in fam1.params){ params1[k] = pick(rng, fam1.params[k]); }
  let eq1;
  if(fam1.key === 'ax_minus_bexp'){ eq1 = `${params1.a} x - ${params1.b} e^{-${params1.k} x} = 0`; }
  else if(fam1.key === 'cubic'){ eq1 = `x^3 - ${params1.alpha} x - ${params1.beta} = 0`; }
  else if(fam1.key === 'coskx_minus_x'){ eq1 = `\\cos(${params1.k}x) - x = 0`; }
  else if(fam1.key === 'exp_minus_gamma_x'){ eq1 = `e^x - ${params1.gamma} x = 0`; }
  else { eq1 = `\\ln(x+${params1.delta}) - ${params1.eta} = 0`; }

  const Q2 = pick(rng, pools.nm.q2Funcs);
  const midpoint = ((Q2.A + Q2.B)/2).toFixed(4);

  // Q3 family
  const fam3 = pick(rng, pools.nm.q3Families);
  let q3eq, q3exact;
  if(fam3.key==='ay'){
    const a = pick(rng, fam3.params.a);
    q3eq = `\\dfrac{dy}{dx} = ${a}\\,y,\\quad y(0)=1`;
    q3exact = `y = e^{${a}x}`;
  }else if(fam3.key==='x_plus_y'){
    q3eq = `\\dfrac{dy}{dx} = x + y,\\quad y(0)=1`;
    q3exact = `y = 2e^{x} - x - 1`;
  }else if(fam3.key==='mxy'){
    q3eq = `\\dfrac{dy}{dx} = -2xy,\\quad y(0)=2`;
    q3exact = `y = 2e^{-x^{2}}`;
  }else if(fam3.key==='siny_y'){
    q3eq = `\\dfrac{dy}{dx} = (\\sin x)\\,y,\\quad y(0)=1`;
    q3exact = `y = e^{1 - \\cos x}`;
  }else{
    const lambda = pick(rng, fam3.params.lambda);
    const B = pick(rng, fam3.params.B);
    const omega = pick(rng, fam3.params.omega);
    const denom = lambda*lambda + omega*omega;
    const AcoefVal = (B/denom);
    const CcoefVal = (1 - (B*lambda)/denom);
    q3eq = `\\dfrac{dy}{dx} = -${lambda}\\,y + ${B}\\,\\cos(${omega}x),\\quad y(0)=1`;
    q3exact = `y = ${AcoefVal.toFixed(4)}\\,(${lambda.toFixed(3)}\\cos(${omega.toFixed(3)}x)+${omega.toFixed(3)}\\sin(${omega.toFixed(3)}x)) + ${CcoefVal.toFixed(4)}\\,e^{-\\,${lambda.toFixed(3)}x}`;
  }

  // Q4 specific solution coefficients
  const P4 = { c: pick(rng, pools.nm.q4Params.c), y0: pick(rng, pools.nm.q4Params.y0), v0: pick(rng, pools.nm.q4Params.v0) };
  const Acoef = ((3*P4.y0 + (2*P4.v0)/P4.c)/2);
  const Bcoef = (P4.y0 - Acoef);

  // Build LaTeX
  const L = [];
  L.push(`\\documentclass[11pt,a4paper]{article}`);
  L.push(`\\usepackage[margin=2.5cm]{geometry}`);
  L.push(`\\usepackage{amsmath,amssymb,amsthm}`);
  L.push(`\\usepackage{graphicx}`);
  L.push(`\\usepackage{enumitem}`);
  L.push(`\\usepackage{fancyhdr}`);
  L.push(`\\pagestyle{fancy}\\fancyhf{}\\lhead{\\textbf{NUMERICAL METHODS}}\\rhead{\\textbf{VARIANT ${variant}}}\\cfoot{\\thepage}`);
  L.push(`\\begin{document}`);
  L.push(`\\begin{center}{\\LARGE\\textbf{NUMERICAL METHODS}}\\\\[0.5em]{\\Large\\textbf{VARIANT ${variant}}}\\\\[1em]{\\large Student: ${student}}\\\\{\\large ID: ${sid}}\\\\[0.5em]\\rule{\\textwidth}{0.4pt}\\end{center}`);
  L.push(`\\vspace{0.7em}\\noindent\\textbf{Marking:} Q1 (15) + Q2 (15) + Q3 (15) + Q4 (15) + Q5 (40) = 100 marks`);

  // Q1
  L.push(`\\section*{Question 1: Root-finding algorithms ‚Äî 15 marks}`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item For the equation \\[ ${eq1} \\] find three rearrangements $x=g(x)$ so that $x_{n+1}=g(x_n)$: (i) converges to a real root; (ii) converges to the same root faster; (iii) fails to converge. Use 30 iterations from $x_0=0.4$ and explain the observed behaviour.\\hfill [5]`);
  L.push(`\\item Apply Newton--Raphson to the same equation.\\begin{enumerate}[label=\\roman*.] \\item Show 10 successive iterates from any start and state the solution to 10 d.p. \\item From the iterates, estimate the order $p$ and the asymptotic error constant $A$. \\item Compare with the theory \\( A = \\dfrac{f''(x^*)}{2f'(x^*)} \\).\\end{enumerate}\\hfill [7]`);
  L.push(`\\item Briefly investigate Newton--Raphson near a multiple root, e.g. $(x-1)^3=0$.\\hfill [3]`);
  L.push(`\\end{enumerate}`);

  // Q2
  L.push(`\\section*{Question 2: Taylor expansions ‚Äî 15 marks}`);
  L.push(`Take \\(y(x)=${Q2.f}\\) on \\([${Q2.A.toFixed(4)},\\,${Q2.B.toFixed(4)}]\\). The arc length is \\(l=\\int_a^b \\sqrt{1+(y')^2}\\,dx\\). Approximate using a Taylor expansion of the integrand about $x=${midpoint}$.`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item Approximate $l$ with a 6th-order Taylor expansion at the midpoint and plot the Taylor integrand vs. $I(x)=\\sqrt{1+(y')^2}$.\\hfill [3]`);
  L.push(`\\item Give a justified upper bound for the truncation error.\\hfill [7]`);
  L.push(`\\item Repeat with degrees 7‚Äì10; tabulate and state the achieved decimal accuracy.\\hfill [3]`);
  L.push(`\\item If relevant, use symmetry/periodicity to estimate a larger-interval integral and verify numerically.\\hfill [2]`);
  L.push(`\\end{enumerate}`);

  // Q3
  L.push(`\\section*{Question 3: First-order ODEs ‚Äî 15 marks}`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item Describe (with sketches) the basic and modified Euler methods for $dy/dx=f(x,y)$, $y(x_0)=y_0$, and explain why the modified method is more accurate.\\hfill [5]`);
  L.push(`\\item Use Euler with $h=0.05$ to estimate $y(0.1)$ for \\[ ${q3eq} \\] \\hfill [3]`);
  L.push(`\\item For the same IVP, perform 10 steps of size $0.5$ with modified Euler and RK4 from $x=0$ to $x=5$.\\hfill [3]`);
  L.push(`\\item The exact solution is \\[ ${q3exact} \\] Plot it with your approximations and comment.\\hfill [4]`);
  L.push(`\\end{enumerate}`);

  // Q4
  L.push(`\\section*{Question 4: Second-order ODEs ‚Äî 15 marks}`);
  L.push(`Two touching blocks on a $0^{\\circ}$C steel top yield \\( y'' = -2c\\,y' - 0.75\\,c^2 y \\). Take $c=${P4.c}$, $y(0)=${P4.y0}$, $y'(0)=${P4.v0}$.`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item State the modified Euler scheme for second-order ODEs (define any auxiliary variables).\\hfill [4]`);
  L.push(`\\item Compute 10 steps with $h=0.1$; report $y(1)$ clearly.\\hfill [3]`);
  L.push(`\\item From (b), identify an interval containing a local maximum and justify your choice.\\hfill [2]`);
  L.push(`\\item The specific solution is \\[ y = ${Acoef.toFixed(4)}\\,e^{-\\,${(P4.c/2).toFixed(3)}x} + ${Bcoef.toFixed(4)}\\,e^{-\\,${(3*P4.c/2).toFixed(3)}x} \\] Verify by differentiation, then find a local maximum by applying a secant (or similar) method to $y'(x)$ starting from your interval.\\hfill [6]`);
  L.push(`\\end{enumerate}`);

  // Q5 presentation
  L.push(`\\section*{Question 5: Presentation ‚Äî 40 marks}`);
  L.push(`\\textbf{Draft (10 marks):} 150‚Äì250 words + a 1-slide storyboard/figure placeholder (submit 48h before your slot; draft marks awarded only if you present).`);
  L.push(`\\textbf{Presentation (30 marks):} max 3 minutes. Include variant number; one quantitative result from Q1‚ÄìQ4; method/rationale; a brief reflection.`);
  L.push(`\\textbf{Rubric:} Draft (3+3+2+2); Presentation (12+8+5+3+2).`);
  L.push(`\\end{document}`);

  return L.join('\n');
}

function generateCFLaTeX(variant, student, sid){
  const rng = mulberry32(0xBEE5 ^ variant);

  // Q1: parameterised logistic with (a,b)
  const xs = pick(rng, pools.cf.x0Choices);
  const xsStr = xs.join(', ');
  const abTriples = pools.cf.abCases; // fixed set for (c)
  // For text in (a)‚Äì(b) we use a=b=0.5 as in spec
  const tentS = pick(rng, pools.cf.tentS);
  const c1 = pick(rng, pools.cf.juliaC);
  const c2 = pick(rng, pools.cf.juliaC.filter(z => z!==c1));

  const L = [];
  L.push(`\\documentclass[11pt,a4paper]{article}`);
  L.push(`\\usepackage[margin=2.5cm]{geometry}`);
  L.push(`\\usepackage{amsmath,amssymb,amsthm}`);
  L.push(`\\usepackage{graphicx}`);
  L.push(`\\usepackage{enumitem}`);
  L.push(`\\usepackage{fancyhdr}`);
  L.push(`\\pagestyle{fancy}\\fancyhf{}\\lhead{\\textbf{DYNAMICAL SYSTEMS, CHAOS \\& FRACTALS}}\\rhead{\\textbf{VARIANT ${variant}}}\\cfoot{\\thepage}`);
  L.push(`\\begin{document}`);
  L.push(`\\begin{center}{\\LARGE\\textbf{DYNAMICAL SYSTEMS, CHAOS \\& FRACTALS}}\\\\[0.5em]{\\Large\\textbf{VARIANT ${variant}}}\\\\[1em]{\\large Student: ${student}}\\\\{\\large ID: ${sid}}\\\\[0.5em]\\rule{\\textwidth}{0.4pt}\\end{center}`);
  L.push(`\\vspace{0.7em}\\noindent\\textbf{Marking:} Q1 (15) + Q2 (15) + Q3 (15) + Q4 (15) + Q5 (40) = 100 marks`);

  // Q1
  L.push(`\\section*{Question 1: One-dimensional maps ‚Äî 15 marks}`);
  L.push(`Consider the map \\(x_{n+1}=a\\,x_n(1-b\\,x_n)\\), with $x_0\\in\\{${xsStr}\\}$.`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item For $a=b=0.5$, show the orbit tends to zero for all $x_0\\in(0,1)$ by computing $x_n$ for $n=0,\\dots,20$ using $x_0=0.1,0.3,0.9$; plot the three orbits on one labelled figure.\\hfill [5]`);
  L.push(`\\item For $a=b=0.5$ and $x_0=0.3$, find how many iterations are needed so that $x_n<10^{-15}$.\\hfill [4]`);
  L.push(`\\item By plotting/analysis, describe the behaviour for the following parameter pairs (use $x_0=0.1$): (i) $a=1,\\,b=1$; (ii) $a=1.5,\\,b=0.5$; (iii) $a=3.25,\\,b=1$.\\hfill [6]`);
  L.push(`\\end{enumerate}`);

  // Q2 (tent map, explicit domain)
  L.push(`\\section*{Question 2: Fixed and periodic points ‚Äî 15 marks}`);
  L.push(`Use the \\emph{tent map} on \\([0,1]\\): \\[ f(x)= ${tentS}\\,\\min(x,1-x),\\qquad x\\in[0,1]. \\] Keep the same $f$ in all parts.`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item On the same axes, plot $y=f(x)$ and $y=x$ over $[0,1]$.\\hfill [2]`);
  L.push(`\\item Find all fixed points algebraically and explain how (a) is consistent.\\hfill [3]`);
  L.push(`\\item Classify the fixed points using $|f'(x^*)|$ (attracting/repelling).\\hfill [3]`);
  L.push(`\\item Find periodic points up to period 3 and compute their stability.\\hfill [5]`);
  L.push(`\\item Using (c)‚Äì(d), describe the likely long-term behaviour for typical initial conditions.\\hfill [2]`);
  L.push(`\\end{enumerate}`);

  // Q3 Julia
  L.push(`\\section*{Question 3: Filled Julia sets ‚Äî 15 marks}`);
  L.push(`Let $g(z)=z^2+c$ and define $z_{n+1}=g(z_n)$. If $|z_n|>2$ for some $n$, the orbit escapes; the first such $n$ is the \\emph{escape iteration}.`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item Write a function that computes the escape iteration for given $z_0$ and $c$, with maximum $n_{\\text{max}}$ (return $n_{\\text{max}}$ if no escape).\\hfill [3]`);
  L.push(`\\item Plot the filled Julia set for $c=${c1}$ using a $500\\times 500$ grid on $[-1,1]\\times[-1,1]$ and $n_{\\text{max}}=100$ (colour by escape iteration, with colour bar).\\hfill [7]`);
  L.push(`\\item Repeat for $c=${c2}$ with $n_{\\text{max}}=50,100,1000$; comment on differences (connectedness, filaments, etc.).\\hfill [5]`);
  L.push(`\\end{enumerate}`);

  // Q4 Crumpled paper (stats section unchanged)
  L.push(`\\section*{Question 4: Fractal dimension of a crumpled piece of paper ‚Äî 15 marks}`);
  L.push(`\\textbf{Context.} A flat sheet has dimension 2; a solid ball has dimension 3. A crumpled paper ball fills space sparsely and typically has a fractal dimension between 2 and 3, with scaling $M\\propto R^D$ (area proxy for mass $M$, radius $R$).`);
  L.push(`\\textbf{Cohort data collection.} Use identical paper type with several sizes; crumple tightly; measure average diameter (compute $R$); take sheet area as $M$; add $(R,M)$ to the shared ‚ÄúData Analysis Lab‚Äù sheet (see course link).`);
  L.push(`\\begin{enumerate}[label=(\\alph*)]`);
  L.push(`\\item \\textbf{Method \\& log‚Äìlog plot} (‚â•5 points: ‚â•3 yours + ‚â•2 cohort). Convert units (cm, cm$^2$). Let $x=\\log R$, $y=\\log M$; produce a labelled log‚Äìlog scatter; note any outliers and whether kept/excluded.\\hfill [5]`);
  L.push(`\\item \\textbf{Estimating $D$ \\& robustness.} Fit $y=\\alpha + D x$ by least squares; report $\\hat D$, $R^2$, and a 95\\% CI or SE for $D$. Repeat on a different subset (e.g., your points only or trimming extremes) and compare. State whether $\\hat D\\in(2,3)$ and what that implies physically.\\hfill [6]`);
  L.push(`\\item \\textbf{Interpretation.} In 150‚Äì200 words, discuss measurement uncertainty (diameter averaging, non-sphericity), paper/size effects, and why pooling helps reveal the scaling law.\\hfill [4]`);
  L.push(`\\end{enumerate}`);

  // Q5
  L.push(`\\section*{Question 5: Presentation ‚Äî 40 marks}`);
  L.push(`\\textbf{Draft (10):} 150‚Äì250 words + 1-slide storyboard (due 48h before slot; awarded only if you present).`);
  L.push(`\\textbf{Presentation (30):} Max 3 minutes. Show variant; one quantitative result from Q1‚ÄìQ4; method/rationale; reflection. \\textbf{Rubric:} Draft (3,3,2,2); Presentation (12,8,5,3,2).`);
  L.push(`\\end{document}`);

  return L.join('\n');
}

// ===== Generation actions =====
function generateIndividual(){
  const idx = document.getElementById('studentSelect').value;
  const customName = document.getElementById('customName').value.trim();
  const customID = document.getElementById('customID').value.trim();
  const variant = parseInt(document.getElementById('variantSelect').value,10);

  let studentName, studentID;
  if(idx !== ''){
    const s = students[Number(idx)];
    studentName = s.name; studentID = s.id;
  }else if(customName && customID){
    studentName = customName; studentID = customID;
  }else{
    alert('Please select a student OR enter custom name and ID.');
    return;
  }
  if(!(variant>=1 && variant<=30)){
    alert('Variant must be between 1 and 30.');
    return;
  }

  const latex = (currentCourse==='nm')
    ? generateNMLaTeX(variant, studentName, studentID)
    : generateCFLaTeX(variant, studentName, studentID);

  currentIndividualFile = {
    name: (currentCourse==='nm'?'NM_':'CF_') + studentID + '.tex',
    content: latex, student: studentName, variant
  };

  document.getElementById('latexOutput').value = latex;
  document.getElementById('compile-instructions').style.display = 'block';
  alert(`Generated: ${studentName} (Variant ${variant})`);
}

function downloadIndividual(){
  if(!currentIndividualFile){ alert('Generate a file first!'); return; }
  const blob = new Blob([currentIndividualFile.content], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = currentIndividualFile.name; a.click();
  URL.revokeObjectURL(url);
}

function generateAllStudents(){
  const progress = document.getElementById('progress');
  progress.style.display = 'block';
  progress.innerHTML = '<strong>Generating LaTeX files...</strong><br>';
  generatedFiles = [];

  students.forEach(s=>{
    const latex = (currentCourse==='nm')
      ? generateNMLaTeX(s.variant, s.name, s.id)
      : generateCFLaTeX(s.variant, s.name, s.id);
    generatedFiles.push({name:(currentCourse==='nm'?'NM_':'CF_')+s.id+'.tex', content:latex, student:s.name, variant:s.variant});
    progress.innerHTML += `‚úì ${s.name} (Variant ${s.variant})<br>`;
  });

  progress.innerHTML += '<br><strong>‚úÖ All 19 files generated successfully!</strong>';
  document.getElementById('compile-instructions').style.display = 'block';
  if(generatedFiles.length>0){ document.getElementById('latexOutput').value = generatedFiles[0].content; }
}

function downloadAllAsZip(){
  if(generatedFiles.length===0){ alert('Generate files first!'); return; }
  generatedFiles.forEach((file,i)=>{
    setTimeout(()=>{
      const blob = new Blob([file.content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = file.name; a.click();
      URL.revokeObjectURL(url);
    }, i*200);
  });
  alert(`Downloading ${generatedFiles.length} files...\n(Use a ZIP helper like JSZip if you prefer a single archive.)`);
}

// ===== Init after DOM =====
document.addEventListener('DOMContentLoaded', ()=>{
  populateStudentDropdown();
  displayStudents();
});
</script>
</body>
</html>
