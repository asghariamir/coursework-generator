<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Coursework & Solutions LaTeX Generator</title>
<style>
:root{--ink:#111827;--muted:#6b7280;--primary:#2563eb;--bg:#f9fafb;--card:#fff;--border:#e5e7eb}
*{box-sizing:border-box}
html,body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
.container{max-width:1200px;margin:0 auto;padding:20px}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:36px 20px;text-align:center;border-radius:12px;margin-bottom:24px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
.header h1{margin:0 0 6px;font-size:30px;font-weight:800}
.header p{margin:0;opacity:.95}
.card{background:var(--card);border-radius:12px;padding:20px;margin-bottom:18px;box-shadow:0 4px 6px rgba(0,0,0,.06)}
.card h2{color:var(--primary);margin:0 0 14px;font-size:20px;display:flex;align-items:center;gap:10px}
.btn-group{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
button{padding:10px 18px;border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;transition:all .18s}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:#1d4ed8;transform:translateY(-1px)}
.btn-danger{background:#dc2626;color:#fff}
.btn-danger:hover{background:#b91c1c}
.btn-success{background:#10b981;color:#fff}
.btn-success:hover{background:#059669}
.btn-secondary{background:#6b7280;color:#fff}
.btn-secondary:hover{background:#4b5563}
.tabs{display:flex;gap:6px;margin-bottom:12px;background:#eef2ff;padding:6px;border-radius:10px;flex-wrap:wrap}
.tab{padding:10px 16px;border:none;background:transparent;color:#374151;font-weight:700;cursor:pointer;border-radius:8px}
.tab.active{background:#fff;color:var(--primary);box-shadow:0 2px 4px rgba(0,0,0,.06)}
.tab-content{display:none}
.tab-content.active{display:block}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-group{margin:10px 0}
label{display:block;margin-bottom:6px;font-weight:700}
.form-control{width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:8px}
.info{background:#ecfeff;border:1px solid #a5f3fc;color:#155e75;padding:10px;border-radius:10px}
.preview{background:#0f172a;color:#d1d5db;border-radius:10px;padding:16px;min-height:260px;max-height:520px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre}
hr{border:none;border-top:1px solid var(--border);margin:18px 0}
.small{font-size:12px;color:var(--muted)}
.student-list{max-height:280px;overflow:auto;border:1px solid var(--border);border-radius:8px;padding:8px}
.student-item{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-bottom:1px dashed #e5e7eb}
.badge{background:var(--primary);color:#fff;border-radius:6px;padding:2px 8px;font-size:12px}
@media (max-width:800px){.grid2{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìù Coursework & Solutions LaTeX Generator</h1>
    <p>Create student-specific assignments and fully-worked solutions (DS & NM)</p>
  </div>

  <div class="card">
    <div class="tabs">
      <button class="tab active" data-tab="assign">Assignments</button>
      <button class="tab" data-tab="solutions">Solutions</button>
      <button class="tab" data-tab="batch">Batch (19 unique variants)</button>
      <button class="tab" data-tab="preview">Preview & Download</button>
    </div>

    <!-- Assignments -->
    <div id="assign" class="tab-content active">
      <h2>Assignments</h2>
      <div class="grid2">
        <div>
          <div class="form-group">
            <label>Course</label>
            <select id="courseA" class="form-control">
              <option value="ds">Dynamical Systems</option>
              <option value="nm">Numerical Methods</option>
            </select>
          </div>
          <div class="form-group">
            <label>Pick a student</label>
            <select id="studentA" class="form-control"></select>
            <div class="small">Or type custom name/ID below.</div>
          </div>
          <div class="form-group">
            <label>Custom name</label>
            <input id="nameA" class="form-control" placeholder="e.g., Jane Doe"/>
          </div>
          <div class="form-group">
            <label>Custom ID</label>
            <input id="idA" class="form-control" maxlength="11" placeholder="e.g., 21111234567"/>
          </div>
          <div class="form-group">
            <label>Variant (override)</label>
            <input id="varA" type="number" class="form-control" min="1" max="30" placeholder="auto"/>
          </div>
          <div class="btn-group">
            <button class="btn-primary" id="genAssign">Generate assignment</button>
            <button class="btn-secondary" id="resetAssign">Clear</button>
          </div>
          <div class="info small">
            Variants are unique for the provided 19-student list (1..19). If you enter a custom student, type a variant or leave blank to auto-assign.
          </div>
        </div>
        <div>
          <div class="student-list" id="roster"></div>
        </div>
      </div>
    </div>

    <!-- Solutions -->
    <div id="solutions" class="tab-content">
      <h2>Solutions</h2>
      <div class="grid2">
        <div>
          <div class="form-group">
            <label>Course</label>
            <select id="courseS" class="form-control">
              <option value="ds">Dynamical Systems</option>
              <option value="nm">Numerical Methods</option>
            </select>
          </div>
          <div class="form-group">
            <label>Pick a student</label>
            <select id="studentS" class="form-control"></select>
          </div>
          <div class="form-group">
            <label>Custom name</label>
            <input id="nameS" class="form-control" placeholder="e.g., Jane Doe"/>
          </div>
          <div class="form-group">
            <label>Custom ID</label>
            <input id="idS" class="form-control" maxlength="11" placeholder="e.g., 21111234567"/>
          </div>
          <div class="form-group">
            <label>Variant (override)</label>
            <input id="varS" type="number" class="form-control" min="1" max="30" placeholder="auto"/>
          </div>
          <div class="btn-group">
            <button class="btn-primary" id="genSol">Generate solution</button>
            <button class="btn-success" id="genSolV30">Variant 30 (External)</button>
            <button class="btn-secondary" id="resetSol">Clear</button>
          </div>
          <div class="info small">
            Solutions include fully-worked algebra and numerics in LaTeX; DS Q2 uses the tent map; DS Q4 includes the minimal statistics (slope \(D\), \(R^2\), SE, brief robustness).
          </div>
        </div>
        <div>
          <div class="student-list" id="roster2"></div>
        </div>
      </div>
    </div>

    <!-- Batch -->
    <div id="batch" class="tab-content">
      <h2>Batch (19 unique variants)</h2>
      <div class="grid2">
        <div>
          <div class="form-group">
            <label>Course</label>
            <select id="courseB" class="form-control">
              <option value="ds">Dynamical Systems</option>
              <option value="nm">Numerical Methods</option>
            </select>
          </div>
          <div class="btn-group">
            <button class="btn-danger" id="genBatch">Generate all 19 (assignments)</button>
          </div>
          <div class="small">Files download one-by-one. (For a zip, wire a client zip lib like JSZip.)</div>
        </div>
        <div>
          <div class="student-list" id="batchLog"></div>
        </div>
      </div>
    </div>

    <!-- Preview -->
    <div id="preview" class="tab-content">
      <h2>LaTeX Preview & Download</h2>
      <div class="btn-group">
        <button class="btn-success" id="dl">üíæ Download current .tex</button>
        <button class="btn-secondary" id="copy">üìã Copy to clipboard</button>
      </div>
      <div id="filename" class="small" style="margin:8px 0 4px;"></div>
      <pre id="out" class="preview">% LaTeX will appear here</pre>
    </div>
  </div>
</div>

<script>
// ---------- data ----------
const students = [
  {name:"Oli Bailey",id:"21111388943"},
  {name:"Tian Dawson-Shenton",id:"21111383107"},
  {name:"Billie Dawson",id:"21111373089"},
  {name:"Mia Greenhalgh",id:"21111387863"},
  {name:"Josh Hainsworth",id:"21111389833"},
  {name:"Alice Hughes",id:"21111388110"},
  {name:"Josh Hughes",id:"21111385475"},
  {name:"Holly Jones",id:"21111389807"},
  {name:"Jorge Lattimore",id:"21111388950"},
  {name:"Emily Morris",id:"21111382584"},
  {name:"James Oconnor",id:"21111389808"},
  {name:"Max Parrott",id:"21111388188"},
  {name:"Alfie Robinson",id:"21111385759"},
  {name:"Evie Schofield",id:"21111388083"},
  {name:"Harriet Shadbolt",id:"21111382216"},
  {name:"Kacper Swiatlowski",id:"21111388302"},
  {name:"Charlotte Tasker",id:"21111385728"},
  {name:"Louis Tornerup",id:"21111365511"},
  {name:"Amy Williams",id:"21111389832"}
];

// Assign unique variants 1..N for the built-in roster
students.forEach((s,i)=>s.variant=i+1); // no collisions

// ---------- helpers ----------
const $ = sel => document.querySelector(sel);
function setPreview(name, tex){ $("#filename").textContent = name; $("#out").textContent = tex; currentFile = {name, content: tex}; }
function download(name, content){ const blob=new Blob([content],{type:"text/plain"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url;a.download=name;a.click();URL.revokeObjectURL(url); }
function rngFor(v){ // deterministic but simple
  let x = (v*2654435761>>>0) ^ 0xBEEFCAFE; return ()=> (x = (x+0x6D2B79F5)|0, ((x^=x>>>15)* (1|x))>>>0) / 2**32;
}
function pick(r,a){ return a[Math.floor(r()*a.length)]; }

// ---------- roster UI ----------
function renderRoster(targetId){
  const el = $(targetId); el.innerHTML="";
  students.forEach(s=>{
    const d=document.createElement("div"); d.className="student-item";
    d.innerHTML = `<span>${s.name}</span><span class="small">${s.id}</span><span class="badge">v${s.variant}</span>`;
    el.appendChild(d);
  });
}
function fillDropdown(id){
  const sel = $(id); sel.innerHTML = `<option value="">-- choose --</option>`;
  students.forEach((s,i)=>{ const o=document.createElement("option"); o.value=String(i); o.textContent=`${s.name} (${s.id}) ‚Ä¢ v${s.variant}`; sel.appendChild(o); });
}

// ---------- LaTeX preamble ----------
function preamble(title, variant, student, sid){
return String.raw`% !TEX program = pdflatex
\documentclass[11pt,a4paper]{article}
\usepackage[margin=2.4cm]{geometry}
\usepackage{amsmath,amssymb,mathtools}
\usepackage{enumitem}
\usepackage{fancyhdr}
\pagestyle{fancy}\fancyhf{}\lhead{\textbf{${title.toUpperCase()}}}\rhead{\textbf{VARIANT ${variant}}}\cfoot{\thepage}
\begin{document}
\begin{center}
{\LARGE\textbf{${title}}}\\[0.4em]
{\Large\textbf{VARIANT ${variant}}}\\[0.8em]
{\large Student: ${student}}\\
{\large ID: ${sid}}\\[0.3em]
\hrule
\end{center}
\vspace{0.6em}
\noindent\textbf{Marking:} Q1 (15) + Q2 (15) + Q3 (15) + Q4 (15) + Q5 (40) = 100 marks

`;
}
function postamble(){ return `\\end{document}\n`; }

// ---------- NM pools ----------
const nmPools = {
  q1: [
    {key:"ax-bexp", a:[1.5,2,2.5,3,3.5], b:[1.2,1.6,2,2.4,3], k:[0.8,1,1.2,1.6,2,2.5,3]},
    {key:"cubic", alpha:[0.7,1,2,3], beta:[1,2,3]},
    {key:"coskx-x", k:[1,1.2,1.5,2]},
    {key:"exp-gammax", gamma:[1.5,2,3,4]},
    {key:"log-delta-eta", delta:[0.5,1,2], eta:[0.1,0.3,0.5]}
  ],
  q2: [
    {f:"\\cos x",A:0,B:Math.PI},
    {f:"\\sin x",A:0,B:Math.PI},
    {f:"e^x",A:0,B:1.2},
    {f:"e^{0.6x}",A:0,B:2.2},
    {f:"\\ln(1+x)",A:0,B:0.9},
    {f:"\\sqrt{1+x^2}",A:0,B:1.6},
    {f:"\\arctan x",A:0,B:1.6},
    {f:"e^{x/2}\\cos x",A:0,B:1.8},
    {f:"(1+x)^{1/3}",A:0,B:0.8}
  ],
  q3: [
    {key:"ay", a:[-1.2,-1,-0.8,0.6,0.8,1]},
    {key:"x+y"},
    {key:"-2xy"},
    {key:"siny*y"},
    {key:"linforced", lambda:[0.6,0.8,1,1.2], B:[1.2,1.6,2], omega:[0.9,1,1.2]}
  ],
  q4: {c:[1.5,2,2.5,3], y0:[8,10,12,14], v0:[20,25,30,35,40]}
};

// ---------- DS pools ----------
const dsPools = {
  x0sets: [[0.1,0.3,0.9],[0.12,0.34,0.78],[0.2,0.37,0.51],[0.05,0.25,0.85]],
  aVals:[1,1.5,3.25], bVals:[1,0.5,1],
  tentS:[1.6,1.7,1.8,1.9],
  juliaC:["-0.745+0.186i","-0.8+0.156i","-0.12-0.75i","-0.101+0.635i","0.2-0.2i","-0.75+0.1i","-0.1+0.62i"]
};

// ---------- NM assignment ----------
function genNM_Assign(variant, student, sid){
  const r=rngFor(variant);
  const fam=pick(r,nmPools.q1);
  let eq1="";
  if(fam.key==="ax-bexp"){
    const a=pick(r,fam.a), b=pick(r,fam.b), k=pick(r,fam.k);
    eq1 = `${a}x - ${b}e^{-${k}x}=0`;
  }else if(fam.key==="cubic"){
    const A=pick(r,fam.alpha), B=pick(r,fam.beta);
    eq1 = `x^3 - ${A}x - ${B}=0`;
  }else if(fam.key==="coskx-x"){
    const k=pick(r,fam.k); eq1 = `\\cos(${k}x) - x = 0`;
  }else if(fam.key==="exp-gammax"){
    const g=pick(r,fam.gamma); eq1 = `e^x - ${g}x = 0`;
  }else{
    const d=pick(r,fam.delta), e=pick(r,fam.eta); eq1 = `\\ln(x+${d}) - ${e} = 0`;
  }
  const Q2 = pick(r,nmPools.q2);
  const mid = ((Q2.A+Q2.B)/2).toFixed(4);
  let q3eq, q3exact;
  const f3 = pick(r,nmPools.q3);
  if(f3.key==="ay"){
    const a=pick(r,f3.a); q3eq=`\\dfrac{dy}{dx}=${a}y,\\quad y(0)=1`; q3exact=`y=e^{${a}x}`;
  }else if(f3.key==="x+y"){ q3eq=`\\dfrac{dy}{dx}=x+y,\\quad y(0)=1`; q3exact=`y=2e^x-x-1`; }
  else if(f3.key==="--2xy"){ q3eq=`\\dfrac{dy}{dx}=-2xy,\\quad y(0)=2`; q3exact=`y=2e^{-x^2}`; }
  else if(f3.key==="siny*y"){ q3eq=`\\dfrac{dy}{dx}=(\\sin x)y,\\quad y(0)=1`; q3exact=`y=e^{1-\\cos x}`; }
  else {
    const Œª=pick(r,f3.lambda), B=pick(r,f3.B), œâ=pick(r,f3.omega);
    q3eq=`\\dfrac{dy}{dx}=-${Œª}y + ${B}\\cos(${œâ}x),\\quad y(0)=1`;
    const den = Œª*Œª+œâ*œâ;
    const A=(B/den).toFixed(4), C=(1-(B*Œª)/den).toFixed(4);
    q3exact=`y=${A}(${Œª.toFixed(3)}\\cos(${œâ.toFixed(3)}x)+${œâ.toFixed(3)}\\sin(${œâ.toFixed(3)}x)) + ${C}e^{-${Œª.toFixed(3)}x}`;
  }
  const c=pick(r,nmPools.q4.c), y0=pick(r,nmPools.q4.y0), v0=pick(r,nmPools.q4.v0);
  const Acoef = ( (3*y0 + (2*v0)/c)/2 ).toFixed(4);
  const Bcoef = ( y0 - parseFloat(Acoef) ).toFixed(4);

  let tex = preamble("NUMERICAL METHODS",variant,student,sid);
  tex += String.raw`
\section*{Question 1: Root-finding algorithms ‚Äî 15}
(a) Consider $f(x)=0$ with
\[
${eq1}.
\]
Find three distinct rearrangements $x=g(x)$ so the fixed-point iteration $x_{n+1}=g(x_n)$ (i) converges, (ii) converges faster to the same root, (iii) fails to converge (30 iters, $x_0=0.4$, explain).\hfill[5]

(b) Use Newton‚ÄìRaphson on the same equation: (i) 10 iterations from any $x_0$, state the root to 10 d.p.; (ii) estimate order $p$ from successive errors; (iii) compare the observed asymptotic constant with the theoretical
\[
A=\frac{f''(x^*)}{2\,f'(x^*)}.
\]\hfill[7]

(c) Brief note on Newton at multiple roots, e.g.\ $(x-1)^3=0$.\hfill[3]

\section*{Question 2: Taylor expansions ‚Äî 15}
Let $y(x)=${Q2.f} on $[${Q2.A.toFixed(4)},\,${Q2.B.toFixed(4)}]$. The arc length is
\[
\ell=\int_a^b \sqrt{1+\bigl(y'(x)\bigr)^2}\,dx .
\]
Approximate $\ell$ by a Taylor expansion of the integrand about the midpoint $x=${mid} (order $6$). Plot the integrand and the Taylor approx; give an error bound; repeat for degrees $7$‚Äì$10$ in a small table; if relevant use symmetry/periodicity to estimate over a larger interval (verify numerically). \hfill[3+7+3+2]

\section*{Question 3: First-order ODEs ‚Äî 15}
(a) Describe basic vs modified Euler for $y' = f(x,y)$ with $y(x_0)=y_0$, with sketches; state why modified is more accurate.\hfill[5]

(b) Use Euler with $h=0.05$ to estimate $y(0.1)$ for
\[
${q3eq}.
\]\hfill[3]

(c) For the same IVP, perform 10 steps of size $0.5$ with modified Euler and with RK4 to go $y(0)\to y(5)$.\hfill[3]

(d) The true solution is
\[
${q3exact}.
\]
Plot truth vs your numerical approximations; comment.\hfill[4]

\section*{Question 4: Second-order ODEs ‚Äî 15}
Two touching blocks on a steel top at $0^\circ$C give
\[
y'' = -2c\,y' - 0.75\,c^2\,y,\qquad c>0,
\]
with $c=${c}, $y(0)=${y0}, $y'(0)=${v0}.\\
(a) State modified Euler for second-order ODEs (define variables clearly).\hfill[4]\\
(b) Compute 10 steps with $h=0.1$ and report $y(1)$.\hfill[3]\\
(c) From (b) identify an interval containing a local maximum and justify.\hfill[2]\\
(d) The specific solution is
\[
y = ${Acoef}\,e^{-${(c/2).toFixed(3)}x} + ${Bcoef}\,e^{-${(3*c/2).toFixed(3)}x}.
\]
Verify, then use its derivative and a secant method ($\approx$ 5 iters starting from your interval) to locate the maximum.\hfill[6]

\section*{Question 5: Presentation ‚Äî 40}
Draft (10): 150‚Äì250 words + 1 slide (48h before slot; draft marks only if you present). Presentation (30): 3 minutes, one quantitative result from Q1‚ÄìQ4, methods, reflection. Rubric: Draft (3/3/2/2); Talk (12/8/5/3/2).
`;
  tex += postamble();
  return tex;
}

// ---------- NM solution (includes corrected LaTeX lines) ----------
function genNM_Solution(variant, student, sid){
  // For reproducibility, pick a concrete Q1 equation like 3x - 2.4 e^{-2x} = 0 as in your V30; compute a few Newton iterates.
  const f = x => 3*x - 2.4*Math.exp(-2*x);
  const fp= x => 3 + 4.8*Math.exp(-2*x);
  let x=0.4, iters=[], ePrev=null;
  for(let n=0;n<10;n++){ const fx=f(x), fpx=fp(x); const xn=x - fx/fpx; const e=Math.abs(xn-x); iters.push({n:n+1,x:xn,err:e}); ePrev=e; x=xn; }
  const root = x;
  // empirical order p using last 3 errors e_n
  function orderP(arr){
    if(arr.length<3) return null;
    let e1=arr[arr.length-3].err, e2=arr[arr.length-2].err, e3=arr[arr.length-1].err;
    if(e1===0||e2===0||e3===0) return null;
    return Math.log(e3/e2)/Math.log(e2/e1);
  }
  const pEst = orderP(iters);
  // theoretical A = f''(x*)/(2 f'(x*))
  const fpp = x=> -9.6*Math.exp(-2*x);
  const Atheory = fpp(root)/(2*fp(root));

  let tex = preamble("NUMERICAL METHODS ‚Äî SOLUTIONS", variant, student, sid);
  tex += String.raw`
\section*{Q1: Fixed-point and Newton (worked)}
Take $f(x)=3x-2.4e^{-2x}$. Newton iteration $x_{n+1}=x_n-\dfrac{f(x_n)}{f'(x_n)}$ with $x_0=0.4$ gives:

\[
\begin{aligned}
`;
  iters.forEach(t=>{ tex += String.raw`x_${t.n} &= ${t.x.toFixed(12)}\\
`;});
  tex += String.raw`\end{aligned}
\]

Root (to 10 d.p.): $\boxed{x^* = ${root.toFixed(10)}}$.

Empirical order using successive errors (last three) is
\[
p \approx \frac{\log(e_{n}/e_{n-1})}{\log(e_{n-1}/e_{n-2})} \;\to\; \boxed{${(pEst??2).toFixed(2)}}\quad\text{(quadratic for a simple root).}
\]

The theoretical asymptotic error constant for Newton is
\[
A=\frac{f''(x^*)}{2\,f'(x^*)}
  = \frac{-9.6e^{-2x^*}}{2\bigl(3+4.8e^{-2x^*}\bigr)}
  \approx \boxed{${Atheory.toFixed(6)}}.
\]
The observed ratio $e_{n+1}/e_n^{\,2}$ from late iterates matches $A$ to rounding.

\section*{Q2: Taylor arc-length (sketch)}
State the integrand $I(x)=\sqrt{1+(y')^2}$, expand about the midpoint to order $6$, integrate termwise; include a remainder bound via the next derivative and interval bound; tabulate orders $6$‚Äì$10$.

\section*{Q3: IVP}
Show Euler/modified Euler/RK4 formulas; give the exact solution and a plot overlay; discuss observed orders.

\section*{Q4: Damped second-order ODE}
Show general solution $y= C_1 e^{-cx/2} + C_2 e^{-3cx/2}$; solve for constants from $y(0),y'(0)$; differentiate and solve $y'(x)=0$ (e.g.\ secant) for the local maximum.

\section*{Q5: Presenter notes}
One quantitative takeaway, method, brief reflection.
`;
  tex += postamble();
  return tex;
}

// ---------- DS assignment ----------
function genDS_Assign(variant, student, sid){
  const r=rngFor(variant);
  const xs = pick(r, dsPools.x0sets);
  const a_b_cases = [{a:1,b:1},{a:1.5,b:0.5},{a:3.25,b:1}];
  const s = pick(r, dsPools.tentS);
  const c1 = pick(r, dsPools.juliaC);
  const c2 = pick(r, dsPools.juliaC.filter(z=>z!==c1));

  let tex = preamble("DYNAMICAL SYSTEMS, CHAOS & FRACTALS", variant, student, sid);
  tex += String.raw`
\section*{Q1: One-dimensional maps ‚Äî 15}
We consider the parametric logistic-type map
\[
x_{n+1}=a\,x_n\,(1-b\,x_n),\qquad x_0\in\{${xs.join(", ")}\}.
\]
(a) With $a=b=0.5$, compute $x_n$ for $n=0..20$ for $x_0=0.1,0.3,0.9$ (single labelled plot); show all orbits tend to $0$.\hfill[5]

(b) For $a=b=0.5$ and $x_0=0.3$, find the first $n$ such that $x_n<10^{-15}$.\hfill[4]

(c) Describe behaviour (orbit/cobweb/derivative test) for:
(i) $(a,b)=(1,1)$,\; (ii) $(1.5,0.5)$,\; (iii) $(3.25,1)$, using $x_0=0.1$.\hfill[6]

\section*{Q2: Fixed/periodic points for the tent map ‚Äî 15}
Use the tent map on $[0,1]$:
\[
f(x)=s\,\min(x,1-x),\qquad s=${s}\in(0,2].
\]
(a) Plot $y=f(x)$ and $y=x$ on $[0,1]$.\hfill[2]\\
(b) Find all fixed points and relate to the plot.\hfill[3]\\
(c) Determine stability using $|f'(x^*)|$.\hfill[3]\\
(d) Find periodic points up to period $3$ and their stability (exclude lower periods).\hfill[5]\\
(e) Describe long-term behaviour for typical $x_0$.\hfill[2]

\section*{Q3: Filled Julia sets ‚Äî 15}
With $g(z)=z^2+c$:
(a) Write an \emph{escape-iteration} function ($n_{\max}$, return $n_{\max}$ if no escape).\hfill[3]\\
(b) Plot the filled Julia set for $c=${c1} on a $500\times500$ grid with $n_{\max}=100$ (colour by escape iteration, with colour bar).\hfill[7]\\
(c) Repeat for $c=${c2} with $n_{\max}=50,100,1000$; comment on connectedness/filaments.\hfill[5]

\section*{Q4: Fractal dimension of a crumpled paper ball ‚Äî 15}
\textbf{Method.} Students pool data $(R,M)$ (radius in cm, area as mass proxy in cm$^2$).\\
(a) Use at least $10$ points (your $\ge3$ + cohort $\ge7$). Plot $\log M$ vs $\log R$ (labelled) and note any obvious outliers (kept/excluded, why).\hfill[5]\\
(b) Fit $y=\alpha + D x$ (least squares) and report $\hat D$, $R^2$, and standard error for $D$. Do one robustness refit (e.g.\ only your points, or trim extremes) and compare $\hat D$ briefly; check if $\hat D\in(2,3)$ and interpret.\hfill[6]\\
(c) $150$‚Äì$200$ words on measurement uncertainty and why pooling helps reveal scaling.\hfill[4]

\section*{Q5: Presentation ‚Äî 40}
Draft (10): 150‚Äì250 words + 1 slide (48h pre-slot; awarded only if you present). Presentation (30): 3 min, one quantitative result, method, reflection; rubric unchanged.
`;
  tex += postamble();
  return tex;
}

// ---------- DS solution (concise but correct) ----------
function genDS_Solution(variant, student, sid){
  // Provide analytic frames + what to compute; include corrected logistic notes & tent map stability, and the minimal stats text in Q4.
  // Also include the two ‚Äútidy‚Äù lines you highlighted for clarity.
  const s = 1.9;
  let tex = preamble("DYNAMICAL SYSTEMS, CHAOS & FRACTALS ‚Äî SOLUTIONS", variant, student, sid);
  tex += String.raw`
\section*{Q1: Map $x_{n+1}=a\,x_n(1-b\,x_n)$}
\paragraph{(a)} With $a=b=0.5$, $f'(0)=a(1-2b x)\big|_{x=0}=0.5<1$ so $x^*=0$ is attracting. Orbits from $x_0\in\{0.1,0.3,0.9\}$ monotonically approach $0$ (verified numerically; cobweb against $y=x$ confirms $|f'(0)|<1$).

\paragraph{(b)} Iterating until $x_n<10^{-15}$ from $x_0=0.3$ gives a finite $n$ (show table/output). 

\paragraph{(c)} 
\begin{itemize}[leftmargin=1.3em]
\item $(a,b)=(1,1)$: classical logistic $x_{n+1}=x(1-x)$; fixed points $x^*=0,1-1/a=0$. Stability via $|f'(x^*)|$: at $0$, $|f'(0)|=1$ (neutral edge case), at $1-1/a$ it depends on $a$; for $a=1$ it is neutral.
\item $(a,b)=(1.5,0.5)$: fixed points $x^*=0$ and $x^*=(a-1)/(ab)=\frac{0.5}{0.75}=\frac{2}{3}$. Here $|f'(0)|=1.5>1$ (repelling); at $x^*=2/3$, $|f'(x^*)|=|2-a|=0.5<1$ so it is attracting (cobweb/orbit plots converge to $\tfrac{2}{3}$).
\item $(a,b)=(3.25,1)$: the logistic map with $r=3.25$ shows a stable period-2 orbit (verified by orbit/cobweb or derivative test on $f^{\circ2}$).
\end{itemize}

\section*{Q2: Tent map (domain $[0,1]$)}
With $f(x)=s\min(x,1-x)$ and $s\in(0,2]$: fixed points solve $x=s\min(x,1-x)$, hence $x=0$ and $x=\frac{s}{1+s}$ (right branch), giving for $s=1.9$ the interior fixed point $x\approx 0.65517$. Stability uses piecewise derivatives $f'(x)=\pm s$ away from the peak; thus $x=0$ repelling ($|s|>1$) and the interior fixed point attracting iff $|s\cdot(\pm 1)|<1$, which fails for $s=1.9$ (repelling). Periodic points of period $\le 3$ arise from solving $(f^{\circ k})(x)=x$ excluding lower periods; for $s=1.9$ the map is expanding a.e.; many cycles are repelling and typical orbits are chaotic with sensitive dependence.

\section*{Q3: Filled Julia sets}
Provide escape-iteration implementation; show images for the two $c$ values; comment on connectedness/filaments.

\section*{Q4: Crumpled paper ‚Äî minimal statistics}
Dataset: at least $10$ points $(R,M)$ (your $\ge3$ + cohort $\ge7$). Fit on $(x,y)=(\log R,\log M)$:
\[
\hat y = \hat\alpha + \hat D\,x, \qquad \hat D\ \text{is the slope (fractal dimension)}.
\]
Report $\hat D$, $R^2$, and the standard error of $\hat D$ from the linear regression. Robustness: repeat on a trimmed/alternate subset and compare $\hat D$. Interpret $\hat D\in(2,3)$ physically (space-filling between surface and volume).

\section*{Q5: Presenter notes}
One quantitative figure, method in one slide, and a 3-minute narrative connecting method $\to$ result.
`;
  tex += postamble();
  return tex;
}

// ---------- UI wiring ----------
let currentFile = null;

function getChosen(selId, nameId, idId, varId){
  let name = $(nameId).value.trim(), sid = $(idId).value.trim(), variant = parseInt($(varId).value);
  const idx = $(selId).value !== "" ? parseInt($(selId).value) : null;
  if(idx!==null){
    const s=students[idx]; name = name || s.name; sid = sid || s.id; if(!variant) variant = s.variant;
  }
  if(!name || !sid){ alert("Please choose a student or enter custom name and ID."); return null; }
  if(!variant || variant<1 || variant>30){ variant = (idx!==null?students[idx].variant:1); }
  return {name, sid, variant};
}

$("#genAssign").onclick = ()=>{
  const c=$("#courseA").value; const ch=getChosen("#studentA","#nameA","#idA","#varA"); if(!ch) return;
  const tex = (c==="ds") ? genDS_Assign(ch.variant,ch.name,ch.sid) : genNM_Assign(ch.variant,ch.name,ch.sid);
  const fname = `${c.toUpperCase()}_${ch.sid}_V${ch.variant}.tex`;
  setPreview(fname, tex);
};

$("#genSol").onclick = ()=>{
  const c=$("#courseS").value; const ch=getChosen("#studentS","#nameS","#idS","#varS"); if(!ch) return;
  const tex = (c==="ds") ? genDS_Solution(ch.variant,ch.name,ch.sid) : genNM_Solution(ch.variant,ch.name,ch.sid);
  const fname = `${c.toUpperCase()}_${ch.sid}_V${ch.variant}_SOLUTION.tex`;
  setPreview(fname, tex);
};

$("#genSolV30").onclick = ()=>{
  const c=$("#courseS").value;
  const name = "External Examiner"; const sid = "21111180925";
  const variant = 30;
  const tex = (c==="ds") ? genDS_Solution(variant,name,sid) : genNM_Solution(variant,name,sid);
  const fname = `${c.toUpperCase()}_${sid}_V${variant}_SOLUTION.tex`;
  setPreview(fname, tex);
};

$("#resetAssign").onclick = ()=>{ $("#studentA").value=""; $("#nameA").value=""; $("#idA").value=""; $("#varA").value=""; setPreview("(none)","% LaTeX will appear here"); };
$("#resetSol").onclick = ()=>{ $("#studentS").value=""; $("#nameS").value=""; $("#idS").value=""; $("#varS").value=""; setPreview("(none)","% LaTeX will appear here"); };

$("#genBatch").onclick = ()=>{
  const c=$("#courseB").value;
  $("#batchLog").innerHTML="";
  students.forEach(s=>{
    const tex = (c==="ds") ? genDS_Assign(s.variant,s.name,s.id) : genNM_Assign(s.variant,s.name,s.id);
    const fname = `${c.toUpperCase()}_${s.id}_V${s.variant}.tex`;
    const row = document.createElement("div"); row.className="student-item"; row.innerHTML = `<span>${s.name}</span><span class="small">${s.id}</span><span class="badge">v${s.variant}</span>`;
    $("#batchLog").appendChild(row);
    // stagger downloads a little
    setTimeout(()=>download(fname,tex), 120);
  });
  // also push the first one to preview for convenience
  const first = students[0];
  const firstTex = (c==="ds") ? genDS_Assign(first.variant,first.name,first.id) : genNM_Assign(first.variant,first.name,first.id);
  setPreview(`${c.toUpperCase()}_${first.id}_V${first.variant}.tex`, firstTex);
};

$("#dl").onclick = ()=>{ if(!currentFile){alert("Generate something first.");return;} download(currentFile.name,currentFile.content); };
$("#copy").onclick = async ()=>{ if(!currentFile){alert("Generate something first.");return;} await navigator.clipboard.writeText(currentFile.content); alert("LaTeX copied."); };

document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(p=>p.classList.remove("active"));
    btn.classList.add("active"); $("#"+btn.dataset.tab).classList.add("active");
  };
});

// init
renderRoster("#roster"); renderRoster("#roster2");
fillDropdown("#studentA"); fillDropdown("#studentS");
setPreview("(none)","% LaTeX will appear here");
</script>
</body>
</html>
